#!/usr/bin/env bash

git config --global core.editor "nvim"

DISTRO="$(lsb_release -i | cut -f 2-)"

# The spaces are required?!??!?!?!??!?
if [ $DISTRO == "Arch" ]; then
  sudo pacman -S --noconfirm --needed librewolf nwg-look nwg-displays ghostty hyprshot swaync libnotify hypridle zsh fzf hyprlock hyprpaper xdg-desktop-portal-gtk xdg-desktop-portal-hyprland gnome-keyring seahorse swww cliphist brightnessctl 
  sudo pacman -S --noconfirm --needed waybar ttf-font-awesome ttf-nerd-fonts-symbols ttf-cascadia-code ttf-cascadia-code-nerd adobe-source-han-sans-jp-fonts otf-ipafont noto-fonts-cjk
  sudo pacman -S --noconfirm --needed pulseaudio

  #rm -rf ~/.config/hypr
  rm -rf ~/.config/waybar

  yay -S visual-studio-code-bin matugen-bin aurutils pacman-contrib python-pywal python-pywalfox --noconfirm --needed
fi

if [ $DISTRO == "Linuxmint" ]; then
  sudo apt install pulseaudio -y

  # fuck off, why do i need snapd for zig
  # source https://linuxcapable.com/how-to-install-and-enable-snap-on-linux-mint/
  # probably shouldn't have deleted the file already, b/c i can't restore it now :|
  sudo mv /etc/apt/preferences.d/nosnap.pref /etc/apt/preferences.d/nosnap.backup
  sudo apt update
  sudo apt install zsh llvm liblld-dev clang libclang-dev snapd -y
  sudo systemctl enable --now snapd.service
  if ! [ -d "${HOME}/.fzf" ]; then
    git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf
    ~/.fzf/install
  fi
  #if ! type "zig" > /dev/null; then
    #sudo apt install -y snap
    #sudo systemctl enable --now snapd.service
    #snap install ghostty --classic --beta
    #sudo apt remove snapd -y
    #wget https://ziglang.org/download/0.13.0/zig-linux-x86_64-0.13.0.tar.xz -P $HOME/Downloads -nc
    #tar xf $HOME/Downloads/zig-linux-x86_64-0.13.0.tar.xz -C ~/Downloads/
    #git clone -b 0.14.x https://github.com/ziglang/zig $HOME/Downloads/zig
    #cd $HOME/Downloads/zig
    #mkdir build
    #cd build
    #cmake ..
    #make install
  #fi

  #install libre wolf
  if ! type "librewolf" > /dev/null; then
    sudo apt install extrepo -y && sudo extrepo enable librewolf && sudo apt update && sudo apt install librewolf -y
  fi

  # install nvm
  if ! [ -d "${HOME}/.nvm/.git" ]; then
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
  fi


  if ! type "ghostty" > /dev/null; then
    snap install ghostty --classic --beta
  fi
  sudo update-alternatives --install /usr/bin/x-terminal-emulator x-terminal-emulator /snap/bin/ghostty 50
  #git clone https://github.com/ghostty-org/ghostty $HOME/Downloads/ghostty
  #cd $HOME/Downloads/ghostty
  #zig build -Doptimize=ReleaseFast
fi

if ! type "anki" > /dev/null; then
	cd ~/Downloads
	wget -nc https://github.com/ankitects/anki/releases/download/25.07.5/anki-launcher-25.07.5-linux.tar.zst
	tar xaf anki-launcher-25.07.5-linux.tar.zst
	cd anki-launcher-25.07.5-linux
	sudo ./install.sh
fi


rm -rf $HOME/.local/scripts
rm -rf $HOME/Wallpapers
rm $HOME/.bash_profile
rm $HOME/.bashrc
rm $HOME/.zshrc
rm $HOME/.zsh_profile
rm $HOME/.zshenv
rm $HOME/.p10k.zsh

#rm /etc/pulse/default.pa
#systemctl --user stop swww.service
#systemctl --user disable swww.service
if [ $DISTRO == "Linuxmint" ]; then
	if ! test -d $HOME/.config/ghostty/themes; then
		mkdir $HOME/.config/ghostty/themes
	fi
	cp $HOME/.config/ghostty/themes.matugen.mint $HOME/.config/ghostty/themes/matugen
fi

cp $HOME/personal/dev/.config ~/ -r
cp $HOME/personal/dev/Wallpapers ~/ -r
cp $HOME/personal/dev/.local/scripts $HOME/.local/scripts -r
cp $HOME/personal/dev/.bash_profile $HOME/.bash_profile
cp $HOME/personal/dev/.bashrc $HOME/.bashrc
cp $HOME/personal/dev/.zshrc $HOME/.zshrc
cp $HOME/personal/dev/.zsh_profile $HOME/.zsh_profile
cp $HOME/personal/dev/.zshenv $HOME/.zshenv
cp $HOME/personal/dev/.p10k.zsh $HOME/.p10k.zsh

#cp $HOME/personal/dev/etc/pulse/default.pa /etc/pulse/default.pa
#systemctl --user enable swww.service
#systemctl --user start swww.service

if [ $DISTRO == "Arch" ]; then
  hyprctl reload
fi
