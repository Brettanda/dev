#!/usr/bin/env bash

git config --global core.editor "nvim"

NEW=false
DISTRO=""
while getopts n:d: flag; do
  case "${flag}" in
  # this doesn't work with --distro flags only -d
  n) NEW=true ;;
  d) DISTRO=${OPTARG} ;;
  esac
done

# mmm chatgpt code. hopefully this doesn't explode
if [ -z "$DISTRO" ]; then
  if command -v lsb_release >/dev/null 2>&1; then
    DISTRO="$(lsb_release -i | cut -f 2-)"
  else
    echo "Error: No distro provided (-d flag) and 'lsb_release' command not found."
    echo "Please install lsb_release or specify a distro manually with '-d'."
    exit 1
  fi
fi

# The spaces are required?!??!?!?!??!?
# in the if statement
if [ $DISTRO == "Arch" ]; then
  ./install-arch $NEW
fi

if [ $DISTRO == "Linuxmint" ]; then
  ./install-mint
fi

if ! type "anki" >/dev/null; then
  cd ~/Downloads
  wget -nc https://github.com/ankitects/anki/releases/download/25.07.5/anki-launcher-25.07.5-linux.tar.zst
  tar xaf anki-launcher-25.07.5-linux.tar.zst
  cd anki-launcher-25.07.5-linux
  sudo ./install.sh
fi

rm -rf $HOME/.local/scripts
rm -rf $HOME/.local/share/Anki2/addons21/
rm -rf $HOME/Wallpapers
rm $HOME/.bash_profile
rm $HOME/.bashrc
rm $HOME/.zshrc
rm $HOME/.zsh_profile
rm $HOME/.zshenv
rm $HOME/.xinitrc
rm $HOME/.p10k.zsh
rm -rf $HOME/.config/nvim

#rm /etc/pulse/default.pa
#systemctl --user stop swww.service
#systemctl --user disable swww.service
if [ $DISTRO == "Linuxmint" ]; then
  if ! test -d $HOME/.config/ghostty/themes; then
    mkdir $HOME/.config/ghostty/themes
  fi
  cp $HOME/.config/ghostty/themes.matugen.mint $HOME/.config/ghostty/themes/matugen
fi

cp $HOME/personal/dev/.config ~/ -r
cp $HOME/personal/dev/Wallpapers ~/ -r
cp $HOME/personal/dev/.local/scripts $HOME/.local/scripts -r
cp $HOME/personal/dev/.local/share/Anki2/addons21 $HOME/.local/share/Anki2/addons21 -r
cp $HOME/personal/dev/.bash_profile $HOME/.bash_profile
cp $HOME/personal/dev/.bashrc $HOME/.bashrc
cp $HOME/personal/dev/.zshrc $HOME/.zshrc
cp $HOME/personal/dev/.zsh_profile $HOME/.zsh_profile
cp $HOME/personal/dev/.zshenv $HOME/.zshenv
cp $HOME/personal/dev/.xinitrc $HOME/.xinitrc
cp $HOME/personal/dev/.p10k.zsh $HOME/.p10k.zsh

#cp $HOME/personal/dev/etc/pulse/default.pa /etc/pulse/default.pa
#systemctl --user enable swww.service
#systemctl --user start swww.service

if [ $DISTRO == "Arch" ]; then
  hyprctl reload
  matugen image $HOME/.config/hypr/current_wallpaper
fi
